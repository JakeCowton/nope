class Subscription::NotificationJob < ApplicationJob

  queue_as :default

  def perform(notification_id)
    notification = Notification.find notification_id
    data = JSON.parse notification.payload

    case notification.payload['type']
    
    when "customer.subscription.created"
    
    when "customer.subscription.deleted"
      customer = Customer.where(stripe_customer_id: data[:stripe][:data][:object][:id]).first
      customer.update(max_profiles: ENV["SUBSCRIPTION_MIN_PROFILE_COUNT"], stripe_subscription_id: nil)
    
    when "customer.created"
    
    when "customer.updated"
    
    when "customer.source.created"
    
    when "invoice.created"
    
    when "invoice.finalized"
    
    when "invoice.payment_succeeded"
    
    when "charge.succeeded"
      customer = Customer.where(stripe_customer_id: data[:stripe][:data][:object][:id]).first
      customer.update(max_profiles: ENV["SUBSCRIPTION_MAX_PROFILE_COUNT"])
    when "charge.failed"
      customer = Customer.where(stripe_customer_id: data[:stripe][:data][:object][:id]).first
      customer.update(max_profiles: ENV["SUBSCRIPTION_MIN_PROFILE_COUNT"])
    end
  end 

end

#{"id"=>"evt_1DcD5JFXmM4aax794N4kEcBM",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588513,
# "data"=>
#  {"object"=>
#    {"id"=>"sub_E4LVyueOoFwdWC",
#     "object"=>"subscription",
#     "application_fee_percent"=>nil,
#     "billing"=>"charge_automatically",
#     "billing_cycle_anchor"=>1543587478,
#     "cancel_at_period_end"=>false,
#     "canceled_at"=>1543588513,
#     "created"=>1543587478,
#     "current_period_end"=>1546179478,
#     "current_period_start"=>1543587478,
#     "customer"=>"cus_E4LVKAY9NKrZ36",
#     "days_until_due"=>nil,
#     "default_source"=>nil,
#     "discount"=>nil,
#     "ended_at"=>1543588513,
#     "items"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"si_E4LVABJ85UFklz",
#          "object"=>"subscription_item",
#          "created"=>1543587479,
#          "metadata"=>{},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "quantity"=>1,
#          "subscription"=>"sub_E4LVyueOoFwdWC"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/subscription_items?subscription=sub_E4LVyueOoFwdWC"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "plan"=>
#      {"id"=>"plan_E4KeZwymkHhxq0",
#       "object"=>"plan",
#       "active"=>true,
#       "aggregate_usage"=>nil,
#       "amount"=>300,
#       "billing_scheme"=>"per_unit",
#       "created"=>1543584318,
#       "currency"=>"gbp",
#       "interval"=>"month",
#       "interval_count"=>1,
#       "livemode"=>false,
#       "metadata"=>{},
#       "nickname"=>"Beta Plan",
#       "product"=>"prod_E4KdbDkzHsPJLc",
#       "tiers"=>nil,
#       "tiers_mode"=>nil,
#       "transform_usage"=>nil,
#       "trial_period_days"=>nil,
#       "usage_type"=>"licensed"},
#     "quantity"=>1,
#     "start"=>1543587478,
#     "status"=>"canceled",
#     "tax_percent"=>nil,
#     "trial_end"=>nil,
#     "trial_start"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_LhJ6uMOGKOUMnv", "idempotency_key"=>nil},
# "type"=>"customer.subscription.deleted",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD5JFXmM4aax794N4kEcBM",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588513,
#   "data"=>
#    {
      "object"=>
#      {
          "id"=>"sub_E4LVyueOoFwdWC",
#         "object"=>"subscription",
#         "application_fee_percent"=>nil,
#         "billing"=>"charge_automatically",
#         "billing_cycle_anchor"=>1543587478,
#         "cancel_at_period_end"=>false,
#         "canceled_at"=>1543588513,
#         "created"=>1543587478,
#         "current_period_end"=>1546179478,
#         "current_period_start"=>1543587478,
#         "customer"=>"cus_E4LVKAY9NKrZ36",
#         "days_until_due"=>nil,
#         "default_source"=>nil,
#         "discount"=>nil,
#         "ended_at"=>1543588513,
#         "items"=>
#           {
              "object"=>"list",
#             "data"=>
#               [{"id"=>"si_E4LVABJ85UFklz",
#            "object"=>"subscription_item",
#            "created"=>1543587479,
#            "metadata"=>{},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "quantity"=>1,
#            "subscription"=>"sub_E4LVyueOoFwdWC"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/subscription_items?subscription=sub_E4LVyueOoFwdWC"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "plan"=>
#        {"id"=>"plan_E4KeZwymkHhxq0",
#         "object"=>"plan",
#         "active"=>true,
#         "aggregate_usage"=>nil,
#         "amount"=>300,
#         "billing_scheme"=>"per_unit",
#         "created"=>1543584318,
#         "currency"=>"gbp",
#         "interval"=>"month",
#         "interval_count"=>1,
#         "livemode"=>false,
#         "metadata"=>{},
#         "nickname"=>"Beta Plan",
#         "product"=>"prod_E4KdbDkzHsPJLc",
#         "tiers"=>nil,
#         "tiers_mode"=>nil,
#         "transform_usage"=>nil,
#         "trial_period_days"=>nil,
#         "usage_type"=>"licensed"},
#       "quantity"=>1,
#       "start"=>1543587478,
#       "status"=>"canceled",
#       "tax_percent"=>nil,
#       "trial_end"=>nil,
#       "trial_start"=>nil}},
#     "livemode"=>false,
#     "pending_webhooks"=>1,
#     "request"=>{"id"=>"req_LhJ6uMOGKOUMnv", "idempotency_key"=>nil},
#     "type"=>"customer.subscription.deleted"
    }
  }
#++++++++++++++++++++
#{"id"=>"evt_1DcD5ZFXmM4aax79ZPV5krAf",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588529,
# "data"=>
#  {"object"=>
#    {"id"=>"sub_E4LODYBsbm8VpM",
#     "object"=>"subscription",
#     "application_fee_percent"=>nil,
#     "billing"=>"charge_automatically",
#     "billing_cycle_anchor"=>1543587070,
#     "cancel_at_period_end"=>false,
#     "canceled_at"=>1543588529,
#     "created"=>1543587070,
#     "current_period_end"=>1546179070,
#     "current_period_start"=>1543587070,
#     "customer"=>"cus_E4LOoXZUSuN3hd",
#     "days_until_due"=>nil,
#     "default_source"=>nil,
#     "discount"=>nil,
#     "ended_at"=>1543588529,
#     "items"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"si_E4LO0dYqRYU9xT",
#          "object"=>"subscription_item",
#          "created"=>1543587070,
#          "metadata"=>{},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "quantity"=>1,
#          "subscription"=>"sub_E4LODYBsbm8VpM"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/subscription_items?subscription=sub_E4LODYBsbm8VpM"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "plan"=>
#      {"id"=>"plan_E4KeZwymkHhxq0",
#       "object"=>"plan",
#       "active"=>true,
#       "aggregate_usage"=>nil,
#       "amount"=>300,
#       "billing_scheme"=>"per_unit",
#       "created"=>1543584318,
#       "currency"=>"gbp",
#       "interval"=>"month",
#       "interval_count"=>1,
#       "livemode"=>false,
#       "metadata"=>{},
#       "nickname"=>"Beta Plan",
#       "product"=>"prod_E4KdbDkzHsPJLc",
#       "tiers"=>nil,
#       "tiers_mode"=>nil,
#       "transform_usage"=>nil,
#       "trial_period_days"=>nil,
#       "usage_type"=>"licensed"},
#     "quantity"=>1,
#     "start"=>1543587070,
#     "status"=>"canceled",
#     "tax_percent"=>nil,
#     "trial_end"=>nil,
#     "trial_start"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_RaAgYAeQHKnPaT", "idempotency_key"=>nil},
# "type"=>"customer.subscription.deleted",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD5ZFXmM4aax79ZPV5krAf",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588529,
#   "data"=>
#    {"object"=>
#      {"id"=>"sub_E4LODYBsbm8VpM",
#       "object"=>"subscription",
#       "application_fee_percent"=>nil,
#       "billing"=>"charge_automatically",
#       "billing_cycle_anchor"=>1543587070,
#       "cancel_at_period_end"=>false,
#       "canceled_at"=>1543588529,
#       "created"=>1543587070,
#       "current_period_end"=>1546179070,
#       "current_period_start"=>1543587070,
#       "customer"=>"cus_E4LOoXZUSuN3hd",
#       "days_until_due"=>nil,
#       "default_source"=>nil,
#       "discount"=>nil,
#       "ended_at"=>1543588529,
#       "items"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"si_E4LO0dYqRYU9xT",
#            "object"=>"subscription_item",
#            "created"=>1543587070,
#            "metadata"=>{},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "quantity"=>1,
#            "subscription"=>"sub_E4LODYBsbm8VpM"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/subscription_items?subscription=sub_E4LODYBsbm8VpM"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "plan"=>
#        {"id"=>"plan_E4KeZwymkHhxq0",
#         "object"=>"plan",
#         "active"=>true,
#         "aggregate_usage"=>nil,
#         "amount"=>300,
#         "billing_scheme"=>"per_unit",
#         "created"=>1543584318,
#         "currency"=>"gbp",
#         "interval"=>"month",
#         "interval_count"=>1,
#         "livemode"=>false,
#         "metadata"=>{},
#         "nickname"=>"Beta Plan",
#         "product"=>"prod_E4KdbDkzHsPJLc",
#         "tiers"=>nil,
#         "tiers_mode"=>nil,
#         "transform_usage"=>nil,
#         "trial_period_days"=>nil,
#         "usage_type"=>"licensed"},
#       "quantity"=>1,
#       "start"=>1543587070,
#       "status"=>"canceled",
#       "tax_percent"=>nil,
#       "trial_end"=>nil,
#       "trial_start"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_RaAgYAeQHKnPaT", "idempotency_key"=>nil},
#   "type"=>"customer.subscription.deleted"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6YFXmM4aax79MVxQjQt2",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588590,
# "data"=>
#  {"object"=>
#    {"id"=>"cus_E4LomI4c9i1SdS",
#     "object"=>"customer",
#     "account_balance"=>0,
#     "created"=>1543588589,
#     "currency"=>nil,
#     "default_source"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#     "delinquent"=>false,
#     "description"=>nil,
#     "discount"=>nil,
#     "email"=>"jay@faircustodian.com",
#     "invoice_prefix"=>"C3F8457",
#     "livemode"=>false,
#     "metadata"=>{},
#     "shipping"=>nil,
#     "sources"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#          "object"=>"card",
#          "address_city"=>nil,
#          "address_country"=>nil,
#          "address_line1"=>nil,
#          "address_line1_check"=>nil,
#          "address_line2"=>nil,
#          "address_state"=>nil,
#          "address_zip"=>nil,
#          "address_zip_check"=>nil,
#          "brand"=>"Visa",
#          "country"=>"US",
#          "customer"=>"cus_E4LomI4c9i1SdS",
#          "cvc_check"=>"pass",
#          "dynamic_last4"=>nil,
#          "exp_month"=>1,
#          "exp_year"=>2020,
#          "fingerprint"=>"DWP54KjX9mHI9KTU",
#          "funding"=>"credit",
#          "last4"=>"4242",
#          "metadata"=>{},
#          "name"=>"jay@faircustodian.com",
#          "tokenization_method"=>nil}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/sources"},
#     "subscriptions"=>
#      {"object"=>"list",
#       "data"=>[],
#       "has_more"=>false,
#       "total_count"=>0,
#       "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/subscriptions"},
#     "tax_info"=>nil,
#     "tax_info_verification"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_gdwF2dlfn76vup", "idempotency_key"=>nil},
# "type"=>"customer.created",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6YFXmM4aax79MVxQjQt2",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588590,
#   "data"=>
#    {"object"=>
#      {"id"=>"cus_E4LomI4c9i1SdS",
#       "object"=>"customer",
#       "account_balance"=>0,
#       "created"=>1543588589,
#       "currency"=>nil,
#       "default_source"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#       "delinquent"=>false,
#       "description"=>nil,
#       "discount"=>nil,
#       "email"=>"jay@faircustodian.com",
#       "invoice_prefix"=>"C3F8457",
#       "livemode"=>false,
#       "metadata"=>{},
#       "shipping"=>nil,
#       "sources"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#            "object"=>"card",
#            "address_city"=>nil,
#            "address_country"=>nil,
#            "address_line1"=>nil,
#            "address_line1_check"=>nil,
#            "address_line2"=>nil,
#            "address_state"=>nil,
#            "address_zip"=>nil,
#            "address_zip_check"=>nil,
#            "brand"=>"Visa",
#            "country"=>"US",
#            "customer"=>"cus_E4LomI4c9i1SdS",
#            "cvc_check"=>"pass",
#            "dynamic_last4"=>nil,
#            "exp_month"=>1,
#            "exp_year"=>2020,
#            "fingerprint"=>"DWP54KjX9mHI9KTU",
#            "funding"=>"credit",
#            "last4"=>"4242",
#            "metadata"=>{},
#            "name"=>"jay@faircustodian.com",
#            "tokenization_method"=>nil}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/sources"},
#       "subscriptions"=>
#        {"object"=>"list",
#         "data"=>[],
#         "has_more"=>false,
#         "total_count"=>0,
#         "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/subscriptions"},
#       "tax_info"=>nil,
#       "tax_info_verification"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_gdwF2dlfn76vup", "idempotency_key"=>nil},
#   "type"=>"customer.created"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6YFXmM4aax79V4cFyLRo",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588590,
# "data"=>
#  {"object"=>
#    {"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#     "object"=>"card",
#     "address_city"=>nil,
#     "address_country"=>nil,
#     "address_line1"=>nil,
#     "address_line1_check"=>nil,
#     "address_line2"=>nil,
#     "address_state"=>nil,
#     "address_zip"=>nil,
#     "address_zip_check"=>nil,
#     "brand"=>"Visa",
#     "country"=>"US",
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "cvc_check"=>"pass",
#     "dynamic_last4"=>nil,
#     "exp_month"=>1,
#     "exp_year"=>2020,
#     "fingerprint"=>"DWP54KjX9mHI9KTU",
#     "funding"=>"credit",
#     "last4"=>"4242",
#     "metadata"=>{},
#     "name"=>"jay@faircustodian.com",
#     "tokenization_method"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_gdwF2dlfn76vup", "idempotency_key"=>nil},
# "type"=>"customer.source.created",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6YFXmM4aax79V4cFyLRo",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588590,
#   "data"=>
#    {"object"=>
#      {"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#       "object"=>"card",
#       "address_city"=>nil,
#       "address_country"=>nil,
#       "address_line1"=>nil,
#       "address_line1_check"=>nil,
#       "address_line2"=>nil,
#       "address_state"=>nil,
#       "address_zip"=>nil,
#       "address_zip_check"=>nil,
#       "brand"=>"Visa",
#       "country"=>"US",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "cvc_check"=>"pass",
#       "dynamic_last4"=>nil,
#       "exp_month"=>1,
#       "exp_year"=>2020,
#       "fingerprint"=>"DWP54KjX9mHI9KTU",
#       "funding"=>"credit",
#       "last4"=>"4242",
#       "metadata"=>{},
#       "name"=>"jay@faircustodian.com",
#       "tokenization_method"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_gdwF2dlfn76vup", "idempotency_key"=>nil},
#   "type"=>"customer.source.created"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79C4JVreqR",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588590,
# "data"=>
#  {"object"=>
#    {"id"=>"cus_E4LomI4c9i1SdS",
#     "object"=>"customer",
#     "account_balance"=>0,
#     "created"=>1543588589,
#     "currency"=>"gbp",
#     "default_source"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#     "delinquent"=>false,
#     "description"=>nil,
#     "discount"=>nil,
#     "email"=>"jay@faircustodian.com",
#     "invoice_prefix"=>"C3F8457",
#     "livemode"=>false,
#     "metadata"=>{},
#     "shipping"=>nil,
#     "sources"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#          "object"=>"card",
#          "address_city"=>nil,
#          "address_country"=>nil,
#          "address_line1"=>nil,
#          "address_line1_check"=>nil,
#          "address_line2"=>nil,
#          "address_state"=>nil,
#          "address_zip"=>nil,
#          "address_zip_check"=>nil,
#          "brand"=>"Visa",
#          "country"=>"US",
#          "customer"=>"cus_E4LomI4c9i1SdS",
#          "cvc_check"=>"pass",
#          "dynamic_last4"=>nil,
#          "exp_month"=>1,
#          "exp_year"=>2020,
#          "fingerprint"=>"DWP54KjX9mHI9KTU",
#          "funding"=>"credit",
#          "last4"=>"4242",
#          "metadata"=>{},
#          "name"=>"jay@faircustodian.com",
#          "tokenization_method"=>nil}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/sources"},
#     "subscriptions"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"sub_E4LoyPVt73fEg9",
#          "object"=>"subscription",
#          "application_fee_percent"=>nil,
#          "billing"=>"charge_automatically",
#          "billing_cycle_anchor"=>1543588590,
#          "cancel_at_period_end"=>false,
#          "canceled_at"=>nil,
#          "created"=>1543588590,
#          "current_period_end"=>1546180590,
#          "current_period_start"=>1543588590,
#          "customer"=>"cus_E4LomI4c9i1SdS",
#          "days_until_due"=>nil,
#          "default_source"=>nil,
#          "discount"=>nil,
#          "ended_at"=>nil,
#          "items"=>
#           {"object"=>"list",
#            "data"=>
#             [{"id"=>"si_E4LoG1q5kMsHLJ",
#               "object"=>"subscription_item",
#               "created"=>1543588590,
#               "metadata"=>{},
#               "plan"=>
#                {"id"=>"plan_E4KeZwymkHhxq0",
#                 "object"=>"plan",
#                 "active"=>true,
#                 "aggregate_usage"=>nil,
#                 "amount"=>300,
#                 "billing_scheme"=>"per_unit",
#                 "created"=>1543584318,
#                 "currency"=>"gbp",
#                 "interval"=>"month",
#                 "interval_count"=>1,
#                 "livemode"=>false,
#                 "metadata"=>{},
#                 "nickname"=>"Beta Plan",
#                 "product"=>"prod_E4KdbDkzHsPJLc",
#                 "tiers"=>nil,
#                 "tiers_mode"=>nil,
#                 "transform_usage"=>nil,
#                 "trial_period_days"=>nil,
#                 "usage_type"=>"licensed"},
#               "quantity"=>1,
#               "subscription"=>"sub_E4LoyPVt73fEg9"}],
#            "has_more"=>false,
#            "total_count"=>1,
#            "url"=>"/v1/subscription_items?subscription=sub_E4LoyPVt73fEg9"},
#          "livemode"=>false,
#          "metadata"=>{},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "quantity"=>1,
#          "start"=>1543588590,
#          "status"=>"active",
#          "tax_percent"=>nil,
#          "trial_end"=>nil,
#          "trial_start"=>nil}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/subscriptions"},
#     "tax_info"=>nil,
#     "tax_info_verification"=>nil},
#   "previous_attributes"=>{"currency"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"customer.updated",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79C4JVreqR",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588590,
#   "data"=>
#    {"object"=>
#      {"id"=>"cus_E4LomI4c9i1SdS",
#       "object"=>"customer",
#       "account_balance"=>0,
#       "created"=>1543588589,
#       "currency"=>"gbp",
#       "default_source"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#       "delinquent"=>false,
#       "description"=>nil,
#       "discount"=>nil,
#       "email"=>"jay@faircustodian.com",
#       "invoice_prefix"=>"C3F8457",
#       "livemode"=>false,
#       "metadata"=>{},
#       "shipping"=>nil,
#       "sources"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#            "object"=>"card",
#            "address_city"=>nil,
#            "address_country"=>nil,
#            "address_line1"=>nil,
#            "address_line1_check"=>nil,
#            "address_line2"=>nil,
#            "address_state"=>nil,
#            "address_zip"=>nil,
#            "address_zip_check"=>nil,
#            "brand"=>"Visa",
#            "country"=>"US",
#            "customer"=>"cus_E4LomI4c9i1SdS",
#            "cvc_check"=>"pass",
#            "dynamic_last4"=>nil,
#            "exp_month"=>1,
#            "exp_year"=>2020,
#            "fingerprint"=>"DWP54KjX9mHI9KTU",
#            "funding"=>"credit",
#            "last4"=>"4242",
#            "metadata"=>{},
#            "name"=>"jay@faircustodian.com",
#            "tokenization_method"=>nil}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/sources"},
#       "subscriptions"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"sub_E4LoyPVt73fEg9",
#            "object"=>"subscription",
#            "application_fee_percent"=>nil,
#            "billing"=>"charge_automatically",
#            "billing_cycle_anchor"=>1543588590,
#            "cancel_at_period_end"=>false,
#            "canceled_at"=>nil,
#            "created"=>1543588590,
#            "current_period_end"=>1546180590,
#            "current_period_start"=>1543588590,
#            "customer"=>"cus_E4LomI4c9i1SdS",
#            "days_until_due"=>nil,
#            "default_source"=>nil,
#            "discount"=>nil,
#            "ended_at"=>nil,
#            "items"=>
#             {"object"=>"list",
#              "data"=>
#               [{"id"=>"si_E4LoG1q5kMsHLJ",
#                 "object"=>"subscription_item",
#                 "created"=>1543588590,
#                 "metadata"=>{},
#                 "plan"=>
#                  {"id"=>"plan_E4KeZwymkHhxq0",
#                   "object"=>"plan",
#                   "active"=>true,
#                   "aggregate_usage"=>nil,
#                   "amount"=>300,
#                   "billing_scheme"=>"per_unit",
#                   "created"=>1543584318,
#                   "currency"=>"gbp",
#                   "interval"=>"month",
#                   "interval_count"=>1,
#                   "livemode"=>false,
#                   "metadata"=>{},
#                   "nickname"=>"Beta Plan",
#                   "product"=>"prod_E4KdbDkzHsPJLc",
#                   "tiers"=>nil,
#                   "tiers_mode"=>nil,
#                   "transform_usage"=>nil,
#                   "trial_period_days"=>nil,
#                   "usage_type"=>"licensed"},
#                 "quantity"=>1,
#                 "subscription"=>"sub_E4LoyPVt73fEg9"}],
#              "has_more"=>false,
#              "total_count"=>1,
#              "url"=>"/v1/subscription_items?subscription=sub_E4LoyPVt73fEg9"},
#            "livemode"=>false,
#            "metadata"=>{},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "quantity"=>1,
#            "start"=>1543588590,
#            "status"=>"active",
#            "tax_percent"=>nil,
#            "trial_end"=>nil,
#            "trial_start"=>nil}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/customers/cus_E4LomI4c9i1SdS/subscriptions"},
#       "tax_info"=>nil,
#       "tax_info_verification"=>nil},
#     "previous_attributes"=>{"currency"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"customer.updated"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79yE8j1r5K",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588591,
# "data"=>
#  {"object"=>
#    {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#     "object"=>"invoice",
#     "amount_due"=>300,
#     "amount_paid"=>300,
#     "amount_remaining"=>0,
#     "application_fee"=>nil,
#     "attempt_count"=>1,
#     "attempted"=>true,
#     "auto_advance"=>false,
#     "billing"=>"charge_automatically",
#     "billing_reason"=>"subscription_create",
#     "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#     "currency"=>"gbp",
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "date"=>1543588590,
#     "default_source"=>nil,
#     "description"=>nil,
#     "discount"=>nil,
#     "due_date"=>nil,
#     "ending_balance"=>0,
#     "finalized_at"=>1543588590,
#     "hosted_invoice_url"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#     "invoice_pdf"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#     "lines"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"sli_46b6120c5f04fa",
#          "object"=>"line_item",
#          "amount"=>300,
#          "currency"=>"gbp",
#          "description"=>"1 × Beta subscription (at £3.00 / month)",
#          "discountable"=>true,
#          "livemode"=>false,
#          "metadata"=>{},
#          "period"=>{"end"=>1546180590, "start"=>1543588590},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "proration"=>false,
#          "quantity"=>1,
#          "subscription"=>"sub_E4LoyPVt73fEg9",
#          "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#          "type"=>"subscription"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "next_payment_attempt"=>nil,
#     "number"=>"C3F8457-0001",
#     "paid"=>true,
#     "payment_intent"=>nil,
#     "period_end"=>1543588590,
#     "period_start"=>1543588590,
#     "receipt_number"=>nil,
#     "starting_balance"=>0,
#     "statement_descriptor"=>nil,
#     "status"=>"paid",
#     "subscription"=>"sub_E4LoyPVt73fEg9",
#     "subtotal"=>300,
#     "tax"=>0,
#     "tax_percent"=>nil,
#     "total"=>300,
#     "webhooks_delivered_at"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"invoice.finalized",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79yE8j1r5K",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588591,
#   "data"=>
#    {"object"=>
#      {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#       "object"=>"invoice",
#       "amount_due"=>300,
#       "amount_paid"=>300,
#       "amount_remaining"=>0,
#       "application_fee"=>nil,
#       "attempt_count"=>1,
#       "attempted"=>true,
#       "auto_advance"=>false,
#       "billing"=>"charge_automatically",
#       "billing_reason"=>"subscription_create",
#       "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#       "currency"=>"gbp",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "date"=>1543588590,
#       "default_source"=>nil,
#       "description"=>nil,
#       "discount"=>nil,
#       "due_date"=>nil,
#       "ending_balance"=>0,
#       "finalized_at"=>1543588590,
#       "hosted_invoice_url"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#       "invoice_pdf"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#       "lines"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"sli_46b6120c5f04fa",
#            "object"=>"line_item",
#            "amount"=>300,
#            "currency"=>"gbp",
#            "description"=>"1 × Beta subscription (at £3.00 / month)",
#            "discountable"=>true,
#            "livemode"=>false,
#            "metadata"=>{},
#            "period"=>{"end"=>1546180590, "start"=>1543588590},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "proration"=>false,
#            "quantity"=>1,
#            "subscription"=>"sub_E4LoyPVt73fEg9",
#            "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#            "type"=>"subscription"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "next_payment_attempt"=>nil,
#       "number"=>"C3F8457-0001",
#       "paid"=>true,
#       "payment_intent"=>nil,
#       "period_end"=>1543588590,
#       "period_start"=>1543588590,
#       "receipt_number"=>nil,
#       "starting_balance"=>0,
#       "statement_descriptor"=>nil,
#       "status"=>"paid",
#       "subscription"=>"sub_E4LoyPVt73fEg9",
#       "subtotal"=>300,
#       "tax"=>0,
#       "tax_percent"=>nil,
#       "total"=>300,
#       "webhooks_delivered_at"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"invoice.finalized"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79aygDcdxH",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588591,
# "data"=>
#  {"object"=>
#    {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#     "object"=>"invoice",
#     "amount_due"=>300,
#     "amount_paid"=>300,
#     "amount_remaining"=>0,
#     "application_fee"=>nil,
#     "attempt_count"=>1,
#     "attempted"=>true,
#     "auto_advance"=>false,
#     "billing"=>"charge_automatically",
#     "billing_reason"=>"subscription_create",
#     "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#     "currency"=>"gbp",
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "date"=>1543588590,
#     "default_source"=>nil,
#     "description"=>nil,
#     "discount"=>nil,
#     "due_date"=>nil,
#     "ending_balance"=>0,
#     "finalized_at"=>1543588590,
#     "hosted_invoice_url"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#     "invoice_pdf"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#     "lines"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"sli_46b6120c5f04fa",
#          "object"=>"line_item",
#          "amount"=>300,
#          "currency"=>"gbp",
#          "description"=>"1 × Beta subscription (at £3.00 / month)",
#          "discountable"=>true,
#          "livemode"=>false,
#          "metadata"=>{},
#          "period"=>{"end"=>1546180590, "start"=>1543588590},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "proration"=>false,
#          "quantity"=>1,
#          "subscription"=>"sub_E4LoyPVt73fEg9",
#          "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#          "type"=>"subscription"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "next_payment_attempt"=>nil,
#     "number"=>"C3F8457-0001",
#     "paid"=>true,
#     "payment_intent"=>nil,
#     "period_end"=>1543588590,
#     "period_start"=>1543588590,
#     "receipt_number"=>nil,
#     "starting_balance"=>0,
#     "statement_descriptor"=>nil,
#     "status"=>"paid",
#     "subscription"=>"sub_E4LoyPVt73fEg9",
#     "subtotal"=>300,
#     "tax"=>0,
#     "tax_percent"=>nil,
#     "total"=>300,
#     "webhooks_delivered_at"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"invoice.payment_succeeded",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79aygDcdxH",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588591,
#   "data"=>
#    {"object"=>
#      {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#       "object"=>"invoice",
#       "amount_due"=>300,
#       "amount_paid"=>300,
#       "amount_remaining"=>0,
#       "application_fee"=>nil,
#       "attempt_count"=>1,
#       "attempted"=>true,
#       "auto_advance"=>false,
#       "billing"=>"charge_automatically",
#       "billing_reason"=>"subscription_create",
#       "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#       "currency"=>"gbp",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "date"=>1543588590,
#       "default_source"=>nil,
#       "description"=>nil,
#       "discount"=>nil,
#       "due_date"=>nil,
#       "ending_balance"=>0,
#       "finalized_at"=>1543588590,
#       "hosted_invoice_url"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#       "invoice_pdf"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#       "lines"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"sli_46b6120c5f04fa",
#            "object"=>"line_item",
#            "amount"=>300,
#            "currency"=>"gbp",
#            "description"=>"1 × Beta subscription (at £3.00 / month)",
#            "discountable"=>true,
#            "livemode"=>false,
#            "metadata"=>{},
#            "period"=>{"end"=>1546180590, "start"=>1543588590},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "proration"=>false,
#            "quantity"=>1,
#            "subscription"=>"sub_E4LoyPVt73fEg9",
#            "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#            "type"=>"subscription"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "next_payment_attempt"=>nil,
#       "number"=>"C3F8457-0001",
#       "paid"=>true,
#       "payment_intent"=>nil,
#       "period_end"=>1543588590,
#       "period_start"=>1543588590,
#       "receipt_number"=>nil,
#       "starting_balance"=>0,
#       "statement_descriptor"=>nil,
#       "status"=>"paid",
#       "subscription"=>"sub_E4LoyPVt73fEg9",
#       "subtotal"=>300,
#       "tax"=>0,
#       "tax_percent"=>nil,
#       "total"=>300,
#       "webhooks_delivered_at"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"invoice.payment_succeeded"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79GEiRQuWO",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588591,
# "data"=>
#  {"object"=>
#    {"id"=>"sub_E4LoyPVt73fEg9",
#     "object"=>"subscription",
#     "application_fee_percent"=>nil,
#     "billing"=>"charge_automatically",
#     "billing_cycle_anchor"=>1543588590,
#     "cancel_at_period_end"=>false,
#     "canceled_at"=>nil,
#     "created"=>1543588590,
#     "current_period_end"=>1546180590,
#     "current_period_start"=>1543588590,
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "days_until_due"=>nil,
#     "default_source"=>nil,
#     "discount"=>nil,
#     "ended_at"=>nil,
#     "items"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"si_E4LoG1q5kMsHLJ",
#          "object"=>"subscription_item",
#          "created"=>1543588590,
#          "metadata"=>{},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "quantity"=>1,
#          "subscription"=>"sub_E4LoyPVt73fEg9"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/subscription_items?subscription=sub_E4LoyPVt73fEg9"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "plan"=>
#      {"id"=>"plan_E4KeZwymkHhxq0",
#       "object"=>"plan",
#       "active"=>true,
#       "aggregate_usage"=>nil,
#       "amount"=>300,
#       "billing_scheme"=>"per_unit",
#       "created"=>1543584318,
#       "currency"=>"gbp",
#       "interval"=>"month",
#       "interval_count"=>1,
#       "livemode"=>false,
#       "metadata"=>{},
#       "nickname"=>"Beta Plan",
#       "product"=>"prod_E4KdbDkzHsPJLc",
#       "tiers"=>nil,
#       "tiers_mode"=>nil,
#       "transform_usage"=>nil,
#       "trial_period_days"=>nil,
#       "usage_type"=>"licensed"},
#     "quantity"=>1,
#     "start"=>1543588590,
#     "status"=>"active",
#     "tax_percent"=>nil,
#     "trial_end"=>nil,
#     "trial_start"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"customer.subscription.created",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79GEiRQuWO",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588591,
#   "data"=>
#    {"object"=>
#      {"id"=>"sub_E4LoyPVt73fEg9",
#       "object"=>"subscription",
#       "application_fee_percent"=>nil,
#       "billing"=>"charge_automatically",
#       "billing_cycle_anchor"=>1543588590,
#       "cancel_at_period_end"=>false,
#       "canceled_at"=>nil,
#       "created"=>1543588590,
#       "current_period_end"=>1546180590,
#       "current_period_start"=>1543588590,
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "days_until_due"=>nil,
#       "default_source"=>nil,
#       "discount"=>nil,
#       "ended_at"=>nil,
#       "items"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"si_E4LoG1q5kMsHLJ",
#            "object"=>"subscription_item",
#            "created"=>1543588590,
#            "metadata"=>{},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "quantity"=>1,
#            "subscription"=>"sub_E4LoyPVt73fEg9"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/subscription_items?subscription=sub_E4LoyPVt73fEg9"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "plan"=>
#        {"id"=>"plan_E4KeZwymkHhxq0",
#         "object"=>"plan",
#         "active"=>true,
#         "aggregate_usage"=>nil,
#         "amount"=>300,
#         "billing_scheme"=>"per_unit",
#         "created"=>1543584318,
#         "currency"=>"gbp",
#         "interval"=>"month",
#         "interval_count"=>1,
#         "livemode"=>false,
#         "metadata"=>{},
#         "nickname"=>"Beta Plan",
#         "product"=>"prod_E4KdbDkzHsPJLc",
#         "tiers"=>nil,
#         "tiers_mode"=>nil,
#         "transform_usage"=>nil,
#         "trial_period_days"=>nil,
#         "usage_type"=>"licensed"},
#       "quantity"=>1,
#       "start"=>1543588590,
#       "status"=>"active",
#       "tax_percent"=>nil,
#       "trial_end"=>nil,
#       "trial_start"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"customer.subscription.created"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79r22O8qDd",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588591,
# "data"=>
#  {"object"=>
#    {"id"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#     "object"=>"charge",
#     "amount"=>300,
#     "amount_refunded"=>0,
#     "application"=>nil,
#     "application_fee"=>nil,
#     "balance_transaction"=>"txn_1DcD6YFXmM4aax79UKgLGQjo",
#     "captured"=>true,
#     "created"=>1543588590,
#     "currency"=>"gbp",
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "description"=>nil,
#     "destination"=>nil,
#     "dispute"=>nil,
#     "failure_code"=>nil,
#     "failure_message"=>nil,
#     "fraud_details"=>{},
#     "invoice"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#     "livemode"=>false,
#     "metadata"=>{},
#     "on_behalf_of"=>nil,
#     "order"=>nil,
#     "outcome"=>
#      {"network_status"=>"approved_by_network",
#       "reason"=>nil,
#       "risk_level"=>"normal",
#       "risk_score"=>10,
#       "seller_message"=>"Payment complete.",
#       "type"=>"authorized"},
#     "paid"=>true,
#     "payment_intent"=>nil,
#     "receipt_email"=>nil,
#     "receipt_number"=>nil,
#     "refunded"=>false,
#     "refunds"=>
#      {"object"=>"list",
#       "data"=>[],
#       "has_more"=>false,
#       "total_count"=>0,
#       "url"=>"/v1/charges/ch_1DcD6YFXmM4aax7912yAFKli/refunds"},
#     "review"=>nil,
#     "shipping"=>nil,
#     "source"=>
#      {"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#       "object"=>"card",
#       "address_city"=>nil,
#       "address_country"=>nil,
#       "address_line1"=>nil,
#       "address_line1_check"=>nil,
#       "address_line2"=>nil,
#       "address_state"=>nil,
#       "address_zip"=>nil,
#       "address_zip_check"=>nil,
#       "brand"=>"Visa",
#       "country"=>"US",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "cvc_check"=>nil,
#       "dynamic_last4"=>nil,
#       "exp_month"=>1,
#       "exp_year"=>2020,
#       "fingerprint"=>"DWP54KjX9mHI9KTU",
#       "funding"=>"credit",
#       "last4"=>"4242",
#       "metadata"=>{},
#       "name"=>"jay@faircustodian.com",
#       "tokenization_method"=>nil},
#     "source_transfer"=>nil,
#     "statement_descriptor"=>"Fair Custodian Ltd",
#     "status"=>"succeeded",
#     "transfer_group"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"charge.succeeded",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79r22O8qDd",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588591,
#   "data"=>
#    {"object"=>
#      {"id"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#       "object"=>"charge",
#       "amount"=>300,
#       "amount_refunded"=>0,
#       "application"=>nil,
#       "application_fee"=>nil,
#       "balance_transaction"=>"txn_1DcD6YFXmM4aax79UKgLGQjo",
#       "captured"=>true,
#       "created"=>1543588590,
#       "currency"=>"gbp",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "description"=>nil,
#       "destination"=>nil,
#       "dispute"=>nil,
#       "failure_code"=>nil,
#       "failure_message"=>nil,
#       "fraud_details"=>{},
#       "invoice"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#       "livemode"=>false,
#       "metadata"=>{},
#       "on_behalf_of"=>nil,
#       "order"=>nil,
#       "outcome"=>
#        {"network_status"=>"approved_by_network",
#         "reason"=>nil,
#         "risk_level"=>"normal",
#         "risk_score"=>10,
#         "seller_message"=>"Payment complete.",
#         "type"=>"authorized"},
#       "paid"=>true,
#       "payment_intent"=>nil,
#       "receipt_email"=>nil,
#       "receipt_number"=>nil,
#       "refunded"=>false,
#       "refunds"=>
#        {"object"=>"list",
#         "data"=>[],
#         "has_more"=>false,
#         "total_count"=>0,
#         "url"=>"/v1/charges/ch_1DcD6YFXmM4aax7912yAFKli/refunds"},
#       "review"=>nil,
#       "shipping"=>nil,
#       "source"=>
#        {"id"=>"card_1DcD6UFXmM4aax79GN2hvNvA",
#         "object"=>"card",
#         "address_city"=>nil,
#         "address_country"=>nil,
#         "address_line1"=>nil,
#         "address_line1_check"=>nil,
#         "address_line2"=>nil,
#         "address_state"=>nil,
#         "address_zip"=>nil,
#         "address_zip_check"=>nil,
#         "brand"=>"Visa",
#         "country"=>"US",
#         "customer"=>"cus_E4LomI4c9i1SdS",
#         "cvc_check"=>nil,
#         "dynamic_last4"=>nil,
#         "exp_month"=>1,
#         "exp_year"=>2020,
#         "fingerprint"=>"DWP54KjX9mHI9KTU",
#         "funding"=>"credit",
#         "last4"=>"4242",
#         "metadata"=>{},
#         "name"=>"jay@faircustodian.com",
#         "tokenization_method"=>nil},
#       "source_transfer"=>nil,
#       "statement_descriptor"=>"Fair Custodian Ltd",
#       "status"=>"succeeded",
#       "transfer_group"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"charge.succeeded"}}
#++++++++++++++++++++
#{"id"=>"evt_1DcD6ZFXmM4aax79W7EDZJIP",
# "object"=>"event",
# "api_version"=>"2018-11-08",
# "created"=>1543588591,
# "data"=>
#  {"object"=>
#    {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#     "object"=>"invoice",
#     "amount_due"=>300,
#     "amount_paid"=>300,
#     "amount_remaining"=>0,
#     "application_fee"=>nil,
#     "attempt_count"=>1,
#     "attempted"=>true,
#     "auto_advance"=>false,
#     "billing"=>"charge_automatically",
#     "billing_reason"=>"subscription_create",
#     "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#     "currency"=>"gbp",
#     "customer"=>"cus_E4LomI4c9i1SdS",
#     "date"=>1543588590,
#     "default_source"=>nil,
#     "description"=>nil,
#     "discount"=>nil,
#     "due_date"=>nil,
#     "ending_balance"=>0,
#     "finalized_at"=>1543588590,
#     "hosted_invoice_url"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#     "invoice_pdf"=>
#      "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#     "lines"=>
#      {"object"=>"list",
#       "data"=>
#        [{"id"=>"sli_46b6120c5f04fa",
#          "object"=>"line_item",
#          "amount"=>300,
#          "currency"=>"gbp",
#          "description"=>"1 × Beta subscription (at £3.00 / month)",
#          "discountable"=>true,
#          "livemode"=>false,
#          "metadata"=>{},
#          "period"=>{"end"=>1546180590, "start"=>1543588590},
#          "plan"=>
#           {"id"=>"plan_E4KeZwymkHhxq0",
#            "object"=>"plan",
#            "active"=>true,
#            "aggregate_usage"=>nil,
#            "amount"=>300,
#            "billing_scheme"=>"per_unit",
#            "created"=>1543584318,
#            "currency"=>"gbp",
#            "interval"=>"month",
#            "interval_count"=>1,
#            "livemode"=>false,
#            "metadata"=>{},
#            "nickname"=>"Beta Plan",
#            "product"=>"prod_E4KdbDkzHsPJLc",
#            "tiers"=>nil,
#            "tiers_mode"=>nil,
#            "transform_usage"=>nil,
#            "trial_period_days"=>nil,
#            "usage_type"=>"licensed"},
#          "proration"=>false,
#          "quantity"=>1,
#          "subscription"=>"sub_E4LoyPVt73fEg9",
#          "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#          "type"=>"subscription"}],
#       "has_more"=>false,
#       "total_count"=>1,
#       "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#     "livemode"=>false,
#     "metadata"=>{},
#     "next_payment_attempt"=>nil,
#     "number"=>"C3F8457-0001",
#     "paid"=>true,
#     "payment_intent"=>nil,
#     "period_end"=>1543588590,
#     "period_start"=>1543588590,
#     "receipt_number"=>nil,
#     "starting_balance"=>0,
#     "statement_descriptor"=>nil,
#     "status"=>"paid",
#     "subscription"=>"sub_E4LoyPVt73fEg9",
#     "subtotal"=>300,
#     "tax"=>0,
#     "tax_percent"=>nil,
#     "total"=>300,
#     "webhooks_delivered_at"=>nil}},
# "livemode"=>false,
# "pending_webhooks"=>1,
# "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
# "type"=>"invoice.created",
# "controller"=>"api/stripe",
# "action"=>"notifications",
# "stripe"=>
#  {"id"=>"evt_1DcD6ZFXmM4aax79W7EDZJIP",
#   "object"=>"event",
#   "api_version"=>"2018-11-08",
#   "created"=>1543588591,
#   "data"=>
#    {"object"=>
#      {"id"=>"in_1DcD6YFXmM4aax79vbrC4G0R",
#       "object"=>"invoice",
#       "amount_due"=>300,
#       "amount_paid"=>300,
#       "amount_remaining"=>0,
#       "application_fee"=>nil,
#       "attempt_count"=>1,
#       "attempted"=>true,
#       "auto_advance"=>false,
#       "billing"=>"charge_automatically",
#       "billing_reason"=>"subscription_create",
#       "charge"=>"ch_1DcD6YFXmM4aax7912yAFKli",
#       "currency"=>"gbp",
#       "customer"=>"cus_E4LomI4c9i1SdS",
#       "date"=>1543588590,
#       "default_source"=>nil,
#       "description"=>nil,
#       "discount"=>nil,
#       "due_date"=>nil,
#       "ending_balance"=>0,
#       "finalized_at"=>1543588590,
#       "hosted_invoice_url"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6",
#       "invoice_pdf"=>
#        "https://pay.stripe.com/invoice/invst_euZpC1Y8NiChIeNmzb5RlirZW6/pdf",
#       "lines"=>
#        {"object"=>"list",
#         "data"=>
#          [{"id"=>"sli_46b6120c5f04fa",
#            "object"=>"line_item",
#            "amount"=>300,
#            "currency"=>"gbp",
#            "description"=>"1 × Beta subscription (at £3.00 / month)",
#            "discountable"=>true,
#            "livemode"=>false,
#            "metadata"=>{},
#            "period"=>{"end"=>1546180590, "start"=>1543588590},
#            "plan"=>
#             {"id"=>"plan_E4KeZwymkHhxq0",
#              "object"=>"plan",
#              "active"=>true,
#              "aggregate_usage"=>nil,
#              "amount"=>300,
#              "billing_scheme"=>"per_unit",
#              "created"=>1543584318,
#              "currency"=>"gbp",
#              "interval"=>"month",
#              "interval_count"=>1,
#              "livemode"=>false,
#              "metadata"=>{},
#              "nickname"=>"Beta Plan",
#              "product"=>"prod_E4KdbDkzHsPJLc",
#              "tiers"=>nil,
#              "tiers_mode"=>nil,
#              "transform_usage"=>nil,
#              "trial_period_days"=>nil,
#              "usage_type"=>"licensed"},
#            "proration"=>false,
#            "quantity"=>1,
#            "subscription"=>"sub_E4LoyPVt73fEg9",
#            "subscription_item"=>"si_E4LoG1q5kMsHLJ",
#            "type"=>"subscription"}],
#         "has_more"=>false,
#         "total_count"=>1,
#         "url"=>"/v1/invoices/in_1DcD6YFXmM4aax79vbrC4G0R/lines"},
#       "livemode"=>false,
#       "metadata"=>{},
#       "next_payment_attempt"=>nil,
#       "number"=>"C3F8457-0001",
#       "paid"=>true,
#       "payment_intent"=>nil,
#       "period_end"=>1543588590,
#       "period_start"=>1543588590,
#       "receipt_number"=>nil,
#       "starting_balance"=>0,
#       "statement_descriptor"=>nil,
#       "status"=>"paid",
#       "subscription"=>"sub_E4LoyPVt73fEg9",
#       "subtotal"=>300,
#       "tax"=>0,
#       "tax_percent"=>nil,
#       "total"=>300,
#       "webhooks_delivered_at"=>nil}},
#   "livemode"=>false,
#   "pending_webhooks"=>1,
#   "request"=>{"id"=>"req_p76FPUkCAyOPXC", "idempotency_key"=>nil},
#   "type"=>"invoice.created"}}
## ++++++++++++++++++++#