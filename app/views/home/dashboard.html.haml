#dashboard.mx-5
  .row.mb-5
    .col-sm-4
      - if current_user.stripe_subscription_id.empty?
        .alert.alert-primary.mt-2
          = form_tag charges_path do
            %article
              - if flash[:error].present?
                #error_explantation
                  %p=flash[:error]

              %label.amount
                %span
                  = "Upgrade your account with up to #{(ENV['SUBSCRIPTION_MAX_PROFILE_COUNT'].to_i - ENV['SUBSCRIPTION_MIN_PROFILE_COUNT'].to_i)} more custom addresses for Â£3.00/month"

            %script.stripe-button{src: "https://checkout.stripe.com/checkout.js", data: {key: Rails.configuration.stripe[:publishable_key], description: "Upgrade to a paid subscription", amount: "300", locale: 'auto', name: 'FairCustodian', currency: 'GBP', email: current_user.email, label: "Upgrade FairCustodian"}}

      .alert.alert-info.mt-2
        %article
          %label.amount
            %span
              = "Share your referral link and when your friends sign up, you both get #{ENV['REFERRER_REWARD']} more free profiles"

        %button.btn.btn-outline-info.btn-lg.copy-button.ml-2.btn-block{data: {toggle: 'tooltip', placement: 'top', clipboard: { text: "https://#{ENV['APP_DOMAIN']}/users/sign_up?referrer_code=#{current_user.referral_code}"}}}
          %i.fas.fa-copy
          Share your link

      %h3.mt-2
        Profiles
        - if current_user.max_profiles > ENV['SUBSCRIPTION_MIN_PROFILE_COUNT'].to_i
          = "#{current_user.profiles.size}/#{current_user.max_profiles}"
      - if current_user.max_profiles > current_user.profiles.count
        = form_for Profile.new, url: profiles_path, html: { class: 'my-3' } do |f|
          .input-group
            = f.text_field :name, class: 'form-control ml-1', value: '', placeholder: 'Create new profile'
            = f.submit 'Create', class: 'btn btn-outline-primary ml-1'
      %ul.list-group.mt-2
        - @profiles.order(created_at: :desc).each do |p|
          = render p


    .col-sm-8
      - if @messages.empty?
        #welcome
          = render partial: 'home/welcome'
        %h3#messages-header.mt-2.d-none All Messages
        %ul#messages-list.list-group{data: {id: current_user.id}}
      - else
        %h3#messages-header.mt-2 All Messages
        %ul#messages-list.list-group{data: {id: current_user.id}}
          - @messages.order(created_at: :desc).each do |m|
            = render m